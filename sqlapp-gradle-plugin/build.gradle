plugins {
    id ('groovy')
	id ("com.gradle.plugin-publish") version "1.3.1"
	id ('com.sqlapp.java-common-conventions')
}

apply plugin: 'java-library'
apply plugin: "io.freefair.lombok"
apply plugin: 'groovy'

configurations {
	all*.exclude module: 'commons-logging'
	all*.exclude module: 'log4j'
	all*.exclude group: 'ch.qos.logback'
	all*.exclude group: 'org.slf4j'
}

dependencies {
	//logging
	//JDBC
	api group: 'com.zaxxer', name: 'HikariCP', version: '6.2.1'

	//api gradleApi()
	//api ('org.gradle:gradle-core:6.1.1'){
	//	exclude group:'org.codehaus.groovy'
	//}
//    api localGroovy()
//	compile project(':sqlapp-core')
	api (project(':sqlapp-command')){
		exclude group:'ch.qos.logback'
		exclude group:'org.slf4j'
	}
//	api (group: 'com.sqlapp', name: 'sqlapp-command', version: '0.12.31'){
//		exclude group:'ch.qos.logback'
//		exclude group:'org.slf4j'
//	}

	//testCompile group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.3.6'
//	testCompile("org.spockframework:spock-core:1.1-groovy-2.4-rc-2"){
//		exclude group: 'org.codehaus.groovy', module: 'groovy-all'
//		exclude group:'org.codehaus.groovy'
//	}
	
	api group: 'javax.activation', name: 'activation', version: '1.1.1'

	// https://mvnrepository.com/artifact/org.codehaus.groovy/groovy-yaml
	api ('org.codehaus.groovy:groovy-yaml:3.0.9'){
		exclude group:'org.codehaus.groovy', module:'groovy'
	}

	testImplementation group: 'org.hsqldb', name: 'hsqldb', version: '2.7.3'
	testImplementation project(':sqlapp-core-hsql')
	
	//JUnit
	testImplementation(platform('org.junit:junit-bom:5.12.0'))
	testImplementation('org.junit.jupiter:junit-jupiter')
	testRuntimeOnly('org.junit.platform:junit-platform-launcher')
	
    testImplementation gradleTestKit()
}

tasks.named('test') {
	//tasks.test {
	jvmArgs(
		"--add-opens", "java.base/java.lang=ALL-UNNAMED",
		"--add-opens", "java.base/java.util=ALL-UNNAMED"
	)
}

version = project.version

gradlePlugin {
	website.set("${scmUrl}")
	vcsUrl.set("${scmConnection}")

	plugins {
		create('sqlappPlugin'){
			id = 'com.sqlapp.db'
			implementationClass = "com.sqlapp.gradle.plugins.DbPlugin"
			displayName = "${description}"
			description = 'Sqlapp Gradle Plugin'
			tags.set(['DB', 'ER diagram', 'schema', 'migration', 'diff'])
		}
	}
}

//generateMetadataFileForMavenJavaPublication.dependsOn validatePlugins
